<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.37">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>CvCrossManova Toolbox – API reference</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./tutorial-other/preparation.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>
    #srs {
        max-width: 30em;
        display: block;
        margin-left: auto;
        margin-right: auto;
    }
</style>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./reference.html">API reference</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">CvCrossManova Toolbox</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./installation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Installation</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./tutorial-fmri-spm/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tutorial: fMRI with SPM</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tutorial-fmri-spm/preparation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preparation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tutorial-fmri-spm/model.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tutorial-fmri-spm/cvmanova.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Cross-validated MANOVA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tutorial-fmri-spm/pairwise.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Pairwise Cross-validated MANOVA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tutorial-fmri-spm/cvcrossmanova.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Cross-validated Cross-MANOVA</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./tutorial-other/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tutorial: Other data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tutorial-other/preparation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preparation</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reference.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">API reference</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="99">
    <h2 id="toc-title">API reference</h2>
   
  <ul>
  <li><a href="#general-notes" id="toc-general-notes" class="nav-link active" data-scroll-target="#general-notes">General notes</a>
  <ul class="collapse">
  <li><a href="#programming-interfaces" id="toc-programming-interfaces" class="nav-link" data-scroll-target="#programming-interfaces">Programming interfaces</a></li>
  <li><a href="#pattern-distinctness-vs-pattern-stability" id="toc-pattern-distinctness-vs-pattern-stability" class="nav-link" data-scroll-target="#pattern-distinctness-vs-pattern-stability">Pattern distinctness vs pattern stability</a></li>
  <li><a href="#permutations" id="toc-permutations" class="nav-link" data-scroll-target="#permutations">Permutations</a></li>
  <li><a href="#searchlight-radius-and-size" id="toc-searchlight-radius-and-size" class="nav-link" data-scroll-target="#searchlight-radius-and-size">Searchlight radius and size</a></li>
  <li><a href="#shrinkage-regularization" id="toc-shrinkage-regularization" class="nav-link" data-scroll-target="#shrinkage-regularization">Shrinkage regularization</a></li>
  <li><a href="#whitening-and-filtering" id="toc-whitening-and-filtering" class="nav-link" data-scroll-target="#whitening-and-filtering">Whitening and filtering</a></li>
  </ul></li>
  <li><a href="#ccmregion" id="toc-ccmregion" class="nav-link" data-scroll-target="#ccmregion"><span class="smallcaps">function</span> <code>ccmRegion</code></a></li>
  <li><a href="#ccmsearchlight" id="toc-ccmsearchlight" class="nav-link" data-scroll-target="#ccmsearchlight"><span class="smallcaps">function</span> <code>ccmSearchlight</code></a></li>
  <li><a href="#analysis" id="toc-analysis" class="nav-link" data-scroll-target="#analysis"><span class="smallcaps">class</span> <code>Analysis</code></a>
  <ul class="collapse">
  <li><a href="#analysis-properties" id="toc-analysis-properties" class="nav-link" data-scroll-target="#analysis-properties"><span class="smallcaps">properties</span></a></li>
  <li><a href="#analysis.analysis" id="toc-analysis.analysis" class="nav-link" data-scroll-target="#analysis.analysis"><span class="smallcaps">constructor</span> <code>Analysis</code></a></li>
  <li><a href="#analysis.leaveonesessionout" id="toc-analysis.leaveonesessionout" class="nav-link" data-scroll-target="#analysis.leaveonesessionout"><span class="smallcaps">static method</span> <code>leaveOneSessionOut</code></a></li>
  <li><a href="#analysis.addpermutations" id="toc-analysis.addpermutations" class="nav-link" data-scroll-target="#analysis.addpermutations"><span class="smallcaps">method</span> <code>addPermutations</code></a></li>
  <li><a href="#analysis.disp" id="toc-analysis.disp" class="nav-link" data-scroll-target="#analysis.disp"><span class="smallcaps">method</span> <code>disp</code></a></li>
  <li><a href="#analysis.show" id="toc-analysis.show" class="nav-link" data-scroll-target="#analysis.show"><span class="smallcaps">method</span> <code>show</code></a></li>
  </ul></li>
  <li><a href="#modeleddata" id="toc-modeleddata" class="nav-link" data-scroll-target="#modeleddata"><span class="smallcaps">class</span> <code>ModeledData</code></a>
  <ul class="collapse">
  <li><a href="#modeleddata-properties" id="toc-modeleddata-properties" class="nav-link" data-scroll-target="#modeleddata-properties"><span class="smallcaps">properties</span></a></li>
  <li><a href="#modeleddata.modeleddata" id="toc-modeleddata.modeleddata" class="nav-link" data-scroll-target="#modeleddata.modeleddata"><span class="smallcaps">constructor</span> <code>ModeledData</code></a></li>
  <li><a href="#modeleddata.fromspm" id="toc-modeleddata.fromspm" class="nav-link" data-scroll-target="#modeleddata.fromspm"><span class="smallcaps">static method</span> <code>fromSPM</code></a></li>
  <li><a href="#modeleddata.disp" id="toc-modeleddata.disp" class="nav-link" data-scroll-target="#modeleddata.disp"><span class="smallcaps">method</span> <code>disp</code></a></li>
  <li><a href="#modeleddata.show" id="toc-modeleddata.show" class="nav-link" data-scroll-target="#modeleddata.show"><span class="smallcaps">method</span> <code>show</code></a></li>
  </ul></li>
  <li><a href="#cvcrossmanova" id="toc-cvcrossmanova" class="nav-link" data-scroll-target="#cvcrossmanova"><span class="smallcaps">class</span> <code>CvCrossManova</code></a>
  <ul class="collapse">
  <li><a href="#cvcrossmanova-properties" id="toc-cvcrossmanova-properties" class="nav-link" data-scroll-target="#cvcrossmanova-properties"><span class="smallcaps">properties</span></a></li>
  <li><a href="#cvcrossmanova.cvcrossmanova" id="toc-cvcrossmanova.cvcrossmanova" class="nav-link" data-scroll-target="#cvcrossmanova.cvcrossmanova"><span class="smallcaps">constructor</span> <code>CvCrossManova</code></a></li>
  <li><a href="#cvcrossmanova.runanalyses" id="toc-cvcrossmanova.runanalyses" class="nav-link" data-scroll-target="#cvcrossmanova.runanalyses"><span class="smallcaps">method</span> <code>runAnalyses</code></a></li>
  <li><a href="#cvcrossmanova.optimizelambda" id="toc-cvcrossmanova.optimizelambda" class="nav-link" data-scroll-target="#cvcrossmanova.optimizelambda"><span class="smallcaps">method</span> <code>optimizeLambda</code></a></li>
  <li><a href="#cvcrossmanova.nresults" id="toc-cvcrossmanova.nresults" class="nav-link" data-scroll-target="#cvcrossmanova.nresults"><span class="smallcaps">method</span> <code>nResults</code></a></li>
  <li><a href="#cvcrossmanova.checkestimability" id="toc-cvcrossmanova.checkestimability" class="nav-link" data-scroll-target="#cvcrossmanova.checkestimability"><span class="smallcaps">method</span> <code>checkEstimability</code></a></li>
  <li><a href="#cvcrossmanova.disp" id="toc-cvcrossmanova.disp" class="nav-link" data-scroll-target="#cvcrossmanova.disp"><span class="smallcaps">method</span> <code>disp</code></a></li>
  </ul></li>
  <li><a href="#searchlightsize" id="toc-searchlightsize" class="nav-link" data-scroll-target="#searchlightsize"><span class="smallcaps">function</span> <code>searchlightSize</code></a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">API reference</h1>
<p class="subtitle lead">Detailed information about toolbox functions and classes</p>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">last modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date">2023–12–7</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>This section documents the public API (application programming interface) of functions and classes provided by the CvCrossManova toolbox. The toolbox contains further helper functions which may also be useful, and they are documented with standard Matlab help comments, but they are not part of the public interface and are not described here.</p>
<section id="general-notes" class="level2">
<h2 class="anchored" data-anchor-id="general-notes">General notes</h2>
<section id="programming-interfaces" class="level3">
<h3 class="anchored" data-anchor-id="programming-interfaces">Programming interfaces</h3>
<p>The CvCrossManova toolbox has two interfaces to perform analyses:</p>
<p>A simplified interface to analyse fMRI data which have been modeled in SPM is provided by the functions <a href="#ccmregion"><code>ccmRegion</code></a> for region-of-interest analyses and <a href="#ccmsearchlight"><code>ccmSearchlight</code></a> for searchlight analyses. Both functions take a parameter <code>analyses</code> which is a cell array of <a href="#analysis"><code>Analysis</code></a> objects specifying analyses.</p>
<p>A more complex but also more versatile interface, which can be used with arbitrary suitable data, is provided by objects of class <a href="#cvcrossmanova"><code>CvCrossManova</code></a>. Upon creation, a <a href="#modeleddata"><code>ModeledData</code></a> object containing data and design matrices as well as an <code>analyses</code> cell array have to be provided. After that, analyses can be run on subsets of dependent variables using the method <a href="#cvcrossmanova.runanalyses"><code>runAnalyses</code></a>.</p>
</section>
<section id="pattern-distinctness-vs-pattern-stability" class="level3">
<h3 class="anchored" data-anchor-id="pattern-distinctness-vs-pattern-stability">Pattern distinctness vs pattern stability</h3>
<p>The CvCrossManova toolbox implements both Cross-validated MANOVA resulting in pattern distinctness <em>D</em> and Cross-validated (Cross-) MANOVA resulting in pattern stability <em>D</em><sup>×</sup>. Which of these a given <a href="#analysis"><code>Analysis</code></a> specification corresponds to depends on the contrast matrices and the regressors involved in them.</p>
<p>In the simplest case where a regressor has the same meaning (corresponds to the same experimental condition) in all sessions (the same set of regressors is present in all sessions in the same order), Cross-validated MANOVA uses a single contrast matrix, which is used for both ‘training’ and ‘validation’, and Cross-validated Cross-MANOVA uses two different contrast matrices. However, if e.g.&nbsp;some experimental events occur only in some sessions and the corresponding regressors therefore do not occur in the others, it may happen that two different contrast matrices are necessary for Cross-validated MANOVA and that a single contrast matrix can be used for Cross-validated Cross-MANOVA.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>It is recommended to always include all regressors in all sessions, even if they may be empty in some of them. This will lead to the corresponding parameter to be inestimable in those sessions, but as long as the contrasts used are estimable, this is not a problem for the analysis.</p>
</div>
</div>
</section>
<section id="permutations" class="level3">
<h3 class="anchored" data-anchor-id="permutations">Permutations</h3>
<p><a href="#analysis.addpermutations"><code>analysis.addPermutations</code></a> adds information to an <a href="#analysis"><code>Analysis</code></a> object that permutations should be applied, so that subsequent analysis runs return not just the actual estimate but also permutation values, which can be used for a permutation test.</p>
<p>The ‘permutation’ method implemented is to switch the sign (±) of GLM parameter estimates in each session separately, as proposed by <span class="citation" data-cites="allefeld2014">Allefeld &amp; Haynes (<a href="#ref-allefeld2014" role="doc-biblioref">2014</a>)</span>. For <em>m</em> sessions there are formally 2<sup><em>m</em></sup> per-session sign permutations, but not all of them lead to different permutation values of <em>D</em>; the number of unique permutations depends on the ‘training’ and ‘validation’ sessions used in different folds. <code>addPermutations</code> determines which permutations can lead to different outcomes and makes sure only those unique permutations are included.</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p>Sign permutations are used to test a per-unit (e.g.&nbsp;participant) null hypothesis of no effect in Cross-validated MANOVA analyses resulting in estimates of <em>D</em>. It does not make sense to apply them to Cross-MANOVA analyses resulting in estimates of <em>D</em><sup>×</sup>.</p>
</div>
</div>
<p>If the number of unique permutations is too large, a maximum number of permutations to be applied can be specified via the parameter <code>maxPerms</code>. In that case, a random subset of permutations is chosen which can be used for a Monte-Carlo permutation test <span class="citation" data-cites="dwass1957">(<a href="#ref-dwass1957" role="doc-biblioref">Dwass, 1957</a>)</span>.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Note that if the permutations are chosen randomly, the result of the permutation test is in principle random, too. To ensure reproducible results, it is recommended to run <code>s = rng('shuffle')</code> once, note the values of <code>s.Seed</code> and <code>s.Type</code>, and then to include <code>rng(&lt;Seed&gt;, &lt;Type&gt;)</code> in your analysis pipeline. This is also necessary for the checkpointing mechanism in <a href="#ccmsearchlight"><code>ccmSearchlight</code></a> to be effective.</p>
</div>
</div>
<p>If permutations are applied, an analysis which would normally return a single value (the actual estimate) instead returns an array of permutation values. Permutations always include the neutral permutation which does not modify the data, and it is always permutation 1, i.e.&nbsp;the actual estimate is always the first in an array of permutation values.</p>
<p>The toolbox does not implement the actual permutation test. For a single unit (participant), a permutation test can be implemented by comparing the actual value with all permutation values (including the actual value resulting from the neutral permutation) and rejecting the null hypothesis at significance level α if the actual value ranks within the upper α-quantile. A simple implementation is <code>pValue = mean(Ds &gt;= Ds(1))</code>. See <span class="citation" data-cites="ernst2004">Ernst (<a href="#ref-ernst2004" role="doc-biblioref">2004</a>)</span> for details, including how to correct for multiple comparisons. For permutation-based population inference for MVPA, see <span class="citation" data-cites="allefeld2016">Allefeld et al. (<a href="#ref-allefeld2016" role="doc-biblioref">2016</a>)</span>.</p>
</section>
<section id="searchlight-radius-and-size" class="level3">
<h3 class="anchored" data-anchor-id="searchlight-radius-and-size">Searchlight radius and size</h3>
<p>The numerical parameter <code>radius</code> of <a href="#ccmsearchlight"><code>ccmSearchlight</code></a> specifies the radius of the searchlight sphere.</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p>Note that a voxel is included in a searchlight if its distance from the center voxel is smaller than <em>or equal to</em> the radius. This convention may be different from the one used by other software packages.</p>
</div>
</div>
<p>By default the radius is in voxels. That can be changed to millimeters by additionally passing <code>mmUnits = true</code>, which uses the information on dimensions and orientation of voxels stored in fMRI data files. If the voxel dimensions are different in different directions, the searchlight sphere in physical space will be an ellipsoid in voxel space.</p>
<p>Fractional values of <code>radius</code> are possible and meaningful:</p>
<div>

</div>
<div id="srs" class="columns quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="column quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<table class="table">
<caption>Radius in voxels<br>
&nbsp;</caption>
<thead>
<tr class="header">
<th style="text-align: center;"><code>radius</code></th>
<th style="text-align: center;"><code>p</code></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">0  </td>
<td style="text-align: center;">  1</td>
</tr>
<tr class="even">
<td style="text-align: center;">1  </td>
<td style="text-align: center;">  7</td>
</tr>
<tr class="odd">
<td style="text-align: center;">1.5</td>
<td style="text-align: center;"> 19</td>
</tr>
<tr class="even">
<td style="text-align: center;">1.8</td>
<td style="text-align: center;"> 27</td>
</tr>
<tr class="odd">
<td style="text-align: center;">2  </td>
<td style="text-align: center;"> 33</td>
</tr>
<tr class="even">
<td style="text-align: center;">2.3</td>
<td style="text-align: center;"> 57</td>
</tr>
<tr class="odd">
<td style="text-align: center;">2.5</td>
<td style="text-align: center;"> 81</td>
</tr>
<tr class="even">
<td style="text-align: center;">2.9</td>
<td style="text-align: center;"> 93</td>
</tr>
<tr class="odd">
<td style="text-align: center;">3  </td>
<td style="text-align: center;">123</td>
</tr>
</tbody>
</table>
</div>
<div class="column quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<table class="table">
<caption>Radius in mm<br>
for voxel size 1 × 1 × 2 mm</caption>
<thead>
<tr class="header">
<th style="text-align: center;"><code>radius</code></th>
<th style="text-align: center;"><code>p</code></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">0  </td>
<td style="text-align: center;">  1</td>
</tr>
<tr class="even">
<td style="text-align: center;">1  </td>
<td style="text-align: center;">  5</td>
</tr>
<tr class="odd">
<td style="text-align: center;">1.5</td>
<td style="text-align: center;">  9</td>
</tr>
<tr class="even">
<td style="text-align: center;">2  </td>
<td style="text-align: center;"> 15</td>
</tr>
<tr class="odd">
<td style="text-align: center;">2.3</td>
<td style="text-align: center;"> 31</td>
</tr>
<tr class="even">
<td style="text-align: center;">2.5</td>
<td style="text-align: center;"> 39</td>
</tr>
<tr class="odd">
<td style="text-align: center;">2.9</td>
<td style="text-align: center;"> 51</td>
</tr>
<tr class="even">
<td style="text-align: center;">3  </td>
<td style="text-align: center;"> 71</td>
</tr>
<tr class="odd">
<td style="text-align: center;">3.2</td>
<td style="text-align: center;"> 79</td>
</tr>
<tr class="even">
<td style="text-align: center;">3.5</td>
<td style="text-align: center;"> 87</td>
</tr>
<tr class="odd">
<td style="text-align: center;">3.7</td>
<td style="text-align: center;">103</td>
</tr>
<tr class="even">
<td style="text-align: center;">3.8</td>
<td style="text-align: center;">119</td>
</tr>
<tr class="odd">
<td style="text-align: center;">4  </td>
<td style="text-align: center;">125</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p><code>p</code> is the maximum number of voxels, which is reached by a searchlight completely within the brain mask; at its boundaries the actual number will be smaller.</p>
<p>You can use the function <a href="#searchlightsize"><code>searchlightSize</code></a> to explore meaningful radii and corresponding searchlight sizes before running an analysis.</p>
</section>
<section id="shrinkage-regularization" class="level3">
<h3 class="anchored" data-anchor-id="shrinkage-regularization">Shrinkage regularization</h3>
<p>The numerical parameter <code>lambda</code> (from 0 to 1) of <a href="#ccmregion"><code>ccmRegion</code></a>, <a href="#ccmsearchlight"><code>ccmSearchlight</code></a>, and <a href="#cvcrossmanova.cvcrossmanova"><code>CvCrossManova</code></a> controls the amount of <a href="https://en.wikipedia.org/wiki/Shrinkage_(statistics)">shrinkage regularization</a> applied to the estimate of the error covariance matrix, which improves the numerical and statistical stability of the estimates of <em>D</em> and <em>D</em><sup>×</sup>. A drawback of regularization is that with it this estimation is no longer unbiased. The small default value of 10<sup>−8</sup> was chosen to limit this effect while still providing somewhat improved numerical stability.</p>
<p>A larger value may be necessary if a larger number of dependent variables (voxels) enter an analysis. While there are approaches to determine the optimal amount of shrinkage regularization from the data <span class="citation" data-cites="schaefer2005">(cf. <a href="#ref-schaefer2005" role="doc-biblioref">Schäfer &amp; Strimmer, 2005</a>)</span>, in our experience they are not sufficiently reliable to be applied automatically.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>It is recommended to usually keep the default value and rather restrict the number of dependent variables (voxels) analyzed together. If that is not possible, one pragmatic approach would be to manually optimize <code>lambda</code> on one unit (e.g.&nbsp;participant) which is then not used for further analysis.</p>
</div>
</div>
<p>The target of the shrinkage regularization is the diagonal matrix where every diagonal element is identical to the error variance averaged across dependent variables. A <code>lambda</code> value of 1 can therefore be used to disregard the error covariance structure, because it replaces the estimated error covariance matrix by this shrinkage target. This can be useful for Cross-MANOVA if it is intended to quantify orthogonality w.r.t. the original data space (Euclidean metric) instead of the whitened space.</p>
</section>
<section id="whitening-and-filtering" class="level3">
<h3 class="anchored" data-anchor-id="whitening-and-filtering">Whitening and filtering</h3>
<p>The logical parameter <code>wf</code> of <a href="#ccmregion"><code>ccmRegion</code></a>, <a href="#ccmsearchlight"><code>ccmSearchlight</code></a>, and <a href="#modeleddata.fromspm"><code>ModeledData.fromSPM</code></a> specifies whether to apply the whitening and high-pass filtering set up in SPM to data and design matrices. The default value is <code>true</code>.</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p>It is recommended to keep the default value. While the pattern distinctness and pattern stability estimators should still be unbiased because the residual degrees of freedom are adjusted, not whitening will lead to decreased precision and not filtering will retain low-frequency signal components which may act as a confound for experimental effects.</p>
</div>
</div>
</section>
</section>
<section id="ccmregion" class="level2">
<h2 class="anchored" data-anchor-id="ccmregion"><span class="smallcaps">function</span> <code>ccmRegion</code></h2>
<p>run Cross-validated (Cross-) MANOVA on regions</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode matlab code-with-copy"><code class="sourceCode matlab"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>[<span class="va">Ds</span><span class="op">,</span> <span class="va">ps</span>] <span class="op">=</span> <span class="va">ccmRegion</span>(<span class="va">modelDir</span><span class="op">,</span> <span class="va">regions</span><span class="op">,</span> <span class="va">analyses</span><span class="op">,</span> <span class="va">wf</span> <span class="op">=</span> <span class="va">true</span><span class="op">,</span> <span class="va">lambda</span> <span class="op">=</span> <span class="fl">1e-8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>modelDir</code> is the directory where the <code>SPM.mat</code> file referring to an estimated model is located.</p>
<p><code>regions</code> is a cell array of logical region masks specified as three-dimensional arrays or filenames.</p>
<p><code>analyses</code> is a cell array of <code>Analysis</code> objects specifying analyses.</p>
<p>The optional <code>wf</code> specifies whether to apply the whitening and high-pass filtering set up in SPM to data and design matrices. It should usually be kept at its default value.</p>
<p>The optional <code>lambda</code> (from 0 to 1) controls the amount of shrinkage regularization applied to the estimate of the error covariance matrix. It should usually be kept at its default value.</p>
<p><code>Ds</code> is a two-dimensional cell array of analysis results. Each cell corresponds to the combination of an analysis (rows) and a region (columns) and contains either a scalar value or an array of permutation values. Whether a result is an estimate of pattern distinctness <em>D</em> or pattern stability <em>D</em><sup>×</sup> depends on the contrasts of the corresponding analysis and the regressors involved in them.</p>
<p><code>ps</code> is an array with the numbers of voxels contained in each region.</p>
</section>
<section id="ccmsearchlight" class="level2">
<h2 class="anchored" data-anchor-id="ccmsearchlight"><span class="smallcaps">function</span> <code>ccmSearchlight</code></h2>
<p>run Cross-validated (Cross-) MANOVA on searchlight</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode matlab code-with-copy"><code class="sourceCode matlab"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="va">ccmSearchlight</span>(<span class="va">modelDir</span><span class="op">,</span> <span class="va">radius</span><span class="op">,</span> <span class="va">analyses</span><span class="op">,</span> <span class="op">...</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="va">mmUnits</span> <span class="op">=</span> <span class="va">false</span><span class="op">,</span> <span class="va">wf</span> <span class="op">=</span> <span class="va">true</span><span class="op">,</span> <span class="va">lambda</span> <span class="op">=</span> <span class="fl">1e-8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>modelDir</code> is the directory where the <code>SPM.mat</code> file referring to an estimated model is located.</p>
<p><code>radius</code> is the radius of the searchlight sphere.</p>
<p><code>analyses</code> is a cell array of <code>Analysis</code> objects specifying analyses.</p>
<p>The optional <code>mmUnits</code> specifies whether the searchlight radius is in voxels or millimeters. By default the value of <code>radius</code> is interpreted as voxels, while interpretation as mm has to be requested by <code>mmUnits = true</code>.</p>
<p>The optional <code>wf</code> specifies whether to apply the whitening and high-pass filtering set up in SPM to data and design matrices. It should usually be kept at its default value.</p>
<p>The optional <code>lambda</code> (from 0 to 1) controls the amount of shrinkage regularization applied to the estimate of the error covariance matrix. It should usually be kept at its default value.</p>
<p>Analysis results are written to image files in the same directory <code>modelDir</code>, with names of the form <code>spmD_A####_P####.nii</code>. The number following <code>A</code> indicates the analysis and the number following <code>P</code> indicates the permutation. Whether a result is an estimate of pattern distinctness <em>D</em> or pattern stability <em>D</em><sup>×</sup> depends on the contrasts of the corresponding analysis and the regressors involved in them.</p>
<p>In addition, an image file <code>VPSL.nii</code> is written containing the numbers of voxels for each searchlight, and a Matlab file <code>ccmSearchlightParams.mat</code> is written containing a record of the analysis parameters.</p>
<p>The searchlight procedure includes a checkpointing mechanism: Intermediate results are saved to a file <code>ccmsCheckpoint….mat</code>, where <code>…</code> stands for a 32-digit hexadecimal checksum of the analysis parameters. If a run of <code>ccmSearchlight</code> is interrupted, running it again recovers partial results from the checkpoint file and continues from there. Note that checkpointing only works if <em>all</em> analysis parameters remain identical. In particular, if the analysis includes randomly selected permutations, make sure to initialize Matlab’s random number generator before the selection.</p>
</section>
<section id="analysis" class="level2">
<h2 class="anchored" data-anchor-id="analysis"><span class="smallcaps">class</span> <code>Analysis</code></h2>
<p>An <code>Analysis</code> object encapsulates ‘training’ and ‘validation’ contrasts and sessions as well as permutations, which together specify a Cross-validated (Cross-) MANOVA analysis.</p>
<section id="analysis-properties" class="level3">
<h3 class="anchored" data-anchor-id="analysis-properties"><span class="smallcaps">properties</span></h3>
<table class="table">
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>CA</code></td>
<td style="text-align: left;">‘training’ contrast matrix, regressors × subcontrasts</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>CB</code></td>
<td style="text-align: left;">‘validation’ contrast matrix, regressors × subcontrasts</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>sessionsA</code></td>
<td style="text-align: left;">‘training’ sessions logical matrix, folds × sessions</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>sessionsB</code></td>
<td style="text-align: left;">‘validation’ sessions logical matrix, folds × sessions</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>L</code></td>
<td style="text-align: left;">number of folds</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>m</code></td>
<td style="text-align: left;">number of sessions</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>perms</code></td>
<td style="text-align: left;">sign permutations, permutations × sessions</td>
</tr>
</tbody>
</table>
</section>
<section id="analysis.analysis" class="level3">
<h3 class="anchored" data-anchor-id="analysis.analysis"><span class="smallcaps">constructor</span> <code>Analysis</code></h3>
<p>create <code>Analysis</code> object</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode matlab code-with-copy"><code class="sourceCode matlab"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="va">analysis</span> <span class="op">=</span> <span class="va">Analysis</span>(<span class="va">CA</span><span class="op">,</span> <span class="va">CB</span><span class="op">,</span> <span class="va">sessionsA</span><span class="op">,</span> <span class="va">sessionsB</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>CA</code> and <code>CB</code> are ‘training’ and ‘validation’ contrast matrices, respectively.</p>
<p><code>sessionsA</code> and <code>sessionsB</code> are logical matrices which indicate which sessions (columns) are used for ‘training’ and ‘validation’, respectively, in each fold (rows).</p>
</section>
<section id="analysis.leaveonesessionout" class="level3">
<h3 class="anchored" data-anchor-id="analysis.leaveonesessionout"><span class="smallcaps">static method</span> <code>leaveOneSessionOut</code></h3>
<p>create <code>Analysis</code> object for leave-one-session-out cross-validation</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode matlab code-with-copy"><code class="sourceCode matlab"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="va">analysis</span> <span class="op">=</span> <span class="va">Analysis</span>.<span class="va">leaveOneSessionOut</span>(<span class="va">m</span><span class="op">,</span> <span class="va">CA</span><span class="op">,</span> <span class="va">CB</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="va">analysis</span> <span class="op">=</span> <span class="va">Analysis</span>.<span class="va">leaveOneSessionOut</span>(<span class="va">m</span><span class="op">,</span> <span class="va">C</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>m</code> is the number of sessions. The object is created with ‘training’ sessions <code>not(logical(eye(m)))</code> and ‘validation’ sessions <code>logical(eye(m))</code>, the specification of standard leave-one-session-out cross-validation.</p>
<p><code>CA</code> and <code>CB</code> are ‘training’ and ‘validation’ contrast matrices, respectively. If only one contrast matrix <code>C</code> is specified, it is used for both.</p>
</section>
<section id="analysis.addpermutations" class="level3">
<h3 class="anchored" data-anchor-id="analysis.addpermutations"><span class="smallcaps">method</span> <code>addPermutations</code></h3>
<p>add sign permutations of per-session parameter estimates</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode matlab code-with-copy"><code class="sourceCode matlab"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="va">analysis</span>.<span class="va">addPermutations</span>(<span class="va">maxPerms</span> <span class="op">=</span> <span class="fl">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This method adds information to <code>analysis</code> that sign permutations should be applied, so that different values of pattern distinctness <em>D</em> for the different permutations are computed.</p>
<p>The optional <code>maxPerms</code> specifies the maximum number of permutations.</p>
</section>
<section id="analysis.disp" class="level3">
<h3 class="anchored" data-anchor-id="analysis.disp"><span class="smallcaps">method</span> <code>disp</code></h3>
<p>textually display information about the object</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode matlab code-with-copy"><code class="sourceCode matlab"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="va">analysis</span>.<span class="va">disp</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This method overrides Matlab’s <code>disp</code>, so you can also use <code>disp(analysis)</code> or simply <code>analysis</code> without semicolon to get the same output.</p>
</section>
<section id="analysis.show" class="level3">
<h3 class="anchored" data-anchor-id="analysis.show"><span class="smallcaps">method</span> <code>show</code></h3>
<p>graphically display information about the object</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode matlab code-with-copy"><code class="sourceCode matlab"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="va">fig</span> <span class="op">=</span> <span class="va">analysis</span>.<span class="va">show</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This method creates a figure showing contrast matrices, session matrices, and if present permutations.</p>
<p><code>fig</code> is the handle of the created figure.</p>
</section>
</section>
<section id="modeleddata" class="level2">
<h2 class="anchored" data-anchor-id="modeleddata"><span class="smallcaps">class</span> <code>ModeledData</code></h2>
<p>A <code>ModeledData</code> object encapsulates data and design matrices for multiple sessions along with supplementary information. Upon creation, it estimates and stores GLM parameters and errors. Combined with one or more <code>Analysis</code> objects, it is the basis for analyses within a <code>CvCrossManova</code> object.</p>
<section id="modeleddata-properties" class="level3">
<h3 class="anchored" data-anchor-id="modeleddata-properties"><span class="smallcaps">properties</span></h3>
<table class="table">
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>Xs</code></td>
<td>cell array of per-session data matrices, observations × independent variables</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>Ys</code></td>
<td>cell array of per-session design matrices, observations × dependent variables</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>fs</code></td>
<td>array of per-session residual degrees of freedom</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>m</code></td>
<td>number of sessions</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>ns</code></td>
<td>array of per-session numbers of observations</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>p</code></td>
<td>number of dependent variables</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>qs</code></td>
<td>array of per-session numbers of independent variables</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>names</code></td>
<td>cell array of per-session string arrays of names of independent variables</td>
</tr>
</tbody>
</table>
</section>
<section id="modeleddata.modeleddata" class="level3">
<h3 class="anchored" data-anchor-id="modeleddata.modeleddata"><span class="smallcaps">constructor</span> <code>ModeledData</code></h3>
<p>create <code>ModeledData</code> object</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode matlab code-with-copy"><code class="sourceCode matlab"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="va">modeledData</span> <span class="op">=</span> <span class="va">ModeledData</span>(<span class="va">Ys</span><span class="op">,</span> <span class="va">Xs</span><span class="op">,</span> <span class="va">fs</span> <span class="op">=</span> <span class="op">...,</span> <span class="va">names</span> <span class="op">=</span> <span class="op">...</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>Ys</code> and <code>Xs</code> are cell arrays of per-session data and design matrices, respectively.</p>
<p>The optional <code>fs</code> is an array of per-session residual degrees of freedom. Their default values are <code>size(Xs{k}, 1) - rank(Xs{k})</code>, corresponding to the assumption that observations are uncorrelated. If observations have been only approximately decorrelated or have been filtered, correct values should be explicitly specified.</p>
<p>The optional <code>names</code> is a cell array of per-session string arrays of names of independent variables. Default names are identical in all sessions and of the form <code>"reg(#)"</code>, where <code>#</code> is the index of the independent variable. If independent variables with the same index in different sessions have different meanings, correct names should be explicitly specified.</p>
</section>
<section id="modeleddata.fromspm" class="level3">
<h3 class="anchored" data-anchor-id="modeleddata.fromspm"><span class="smallcaps">static method</span> <code>fromSPM</code></h3>
<p>create <code>ModeledData</code> object from SPM data</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode matlab code-with-copy"><code class="sourceCode matlab"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>[<span class="va">modeledData</span><span class="op">,</span> <span class="va">misc</span>] <span class="op">=</span> <span class="va">fromSPM</span>(<span class="va">modelDir</span><span class="op">,</span> <span class="va">regions</span> <span class="op">=</span> {}<span class="op">,</span> <span class="va">wf</span> <span class="op">=</span> <span class="va">true</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>modelDir</code> is the directory where the <code>SPM.mat</code> file referring to an estimated model is located.</p>
<p>The optional <code>regions</code> is a cell array of logical region masks specified as three-dimensional arrays or filenames. Without it, only the SPM brain mask is applied.</p>
<p>The optional <code>wf</code> specifies whether to apply the whitening and high-pass filtering set up in SPM to data and design matrices. It should usually be kept at its default value.</p>
<p>Dependent variables (columns of data matrices <code>Ys</code>) are only read from voxels within the SPM analysis brain mask after it was intersected with the union of region masks (if provided).</p>
<p><code>misc</code> is a structure of fields containing additional information:</p>
<table class="table">
<tbody>
<tr class="odd">
<td><code>mask</code></td>
<td style="text-align: left;">logical 3D volume indicating the voxels which dependent variables correspond to</td>
</tr>
<tr class="even">
<td><code>mat</code></td>
<td style="text-align: left;">3D voxel indices to mm transformation matrix</td>
</tr>
<tr class="odd">
<td><code>rmvi</code></td>
<td style="text-align: left;">indices of dependent variables corresponding to each region, cell array of arrays</td>
</tr>
</tbody>
</table>
</section>
<section id="modeleddata.disp" class="level3">
<h3 class="anchored" data-anchor-id="modeleddata.disp"><span class="smallcaps">method</span> <code>disp</code></h3>
<p>textually display information about the object</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode matlab code-with-copy"><code class="sourceCode matlab"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="va">modeledData</span>.<span class="va">disp</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This method overrides Matlab’s <code>disp</code>, so you can also use <code>disp(modeledData)</code> or simply <code>modeledData</code> without semicolon to get the same output.</p>
</section>
<section id="modeleddata.show" class="level3">
<h3 class="anchored" data-anchor-id="modeleddata.show"><span class="smallcaps">method</span> <code>show</code></h3>
<p>graphically display information about the object</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode matlab code-with-copy"><code class="sourceCode matlab"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="va">fig</span> <span class="op">=</span> <span class="va">analysis</span>.<span class="va">show</span>(<span class="va">rescale</span> <span class="op">=</span> <span class="va">true</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This method creates a figure showing the design matrices of all sessions.</p>
<p>The optional <code>rescale</code> specifies whether independent variables are individually rescaled to an absolute maximum of 1, to aid visibility of details.</p>
<p><code>fig</code> is the handle of the created figure.</p>
</section>
</section>
<section id="cvcrossmanova" class="level2">
<h2 class="anchored" data-anchor-id="cvcrossmanova"><span class="smallcaps">class</span> <code>CvCrossManova</code></h2>
<p>A <code>CvCrossManova</code> object implements the Cross-validated (Cross-) MANOVA algorithm. It combines the data and design matrices encapsulated in a <code>ModeledData</code> object with the analysis specifications of one or more <code>Analysis</code> objects. If its method <code>runAnalyses</code> is called for a set of dependent variables, all specified analyses are performed on these variables concurrently. This enables a more efficient implementation of the algorithm, because partial results shared between analyses only have to be computed once.</p>
<section id="cvcrossmanova-properties" class="level3">
<h3 class="anchored" data-anchor-id="cvcrossmanova-properties"><span class="smallcaps">properties</span></h3>
<table class="table">
<tbody>
<tr class="odd">
<td><code>modeledData</code></td>
<td style="text-align: left;">data and design information, <code>ModeledData</code> object</td>
</tr>
<tr class="even">
<td><code>analyses</code></td>
<td style="text-align: left;">analysis specifications, cell array of <code>Analysis</code> objects</td>
</tr>
<tr class="odd">
<td><code>lambda</code></td>
<td style="text-align: left;">amount of shrinkage regularization</td>
</tr>
<tr class="even">
<td><code>nAnalyses</code></td>
<td style="text-align: left;">number of analyses</td>
</tr>
</tbody>
</table>
</section>
<section id="cvcrossmanova.cvcrossmanova" class="level3">
<h3 class="anchored" data-anchor-id="cvcrossmanova.cvcrossmanova"><span class="smallcaps">constructor</span> <code>CvCrossManova</code></h3>
<p>create <code>CvCrossManova</code> object</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode matlab code-with-copy"><code class="sourceCode matlab"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="va">ccm</span> <span class="op">=</span> <span class="va">CvCrossManova</span>(<span class="va">modeledData</span><span class="op">,</span> <span class="va">analyses</span><span class="op">,</span> <span class="va">lambda</span> <span class="op">=</span> <span class="fl">1e-8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>modeledData</code> is a <code>ModeledData</code> object encapsulating data and design matrices for multiple sessions.</p>
<p><code>analyses</code> is a cell array of <code>Analysis</code> objects specifying analyses.</p>
<p>The optional <code>lambda</code> (from 0 to 1) controls the amount of shrinkage regularization applied to the estimate of the error covariance matrix. It should usually be kept at its default value.</p>
</section>
<section id="cvcrossmanova.runanalyses" class="level3">
<h3 class="anchored" data-anchor-id="cvcrossmanova.runanalyses"><span class="smallcaps">method</span> <code>runAnalyses</code></h3>
<p>run analyses on (a subset of) the dependent variables</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode matlab code-with-copy"><code class="sourceCode matlab"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="va">Ds</span> <span class="op">=</span> <span class="va">ccm</span>.<span class="va">runAnalyses</span>(<span class="va">vi</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="va">Ds</span> <span class="op">=</span> <span class="va">ccm</span>.<span class="va">runAnalyses</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>vi</code> specifies the variables to be included in the analysis, as column indices into the data matrices <code>Ys</code> of <code>modeledData</code>. If omitted, all variables are included.</p>
<p><code>Ds</code> is a cell array of analysis results where each cell corresponds to a cell of <code>analyses</code>, either a scalar value or an array of permutation values. Whether a result is an estimate of pattern distinctness <em>D</em> or pattern stability <em>D</em><sup>×</sup> depends on the contrasts of the corresponding analysis and the regressors involved in them.</p>
<p>To determine how many values will be included in each of the cells of <code>Ds</code> before actually running the analyses, e.g.&nbsp;for preallocation, use the method <code>nResults</code>.</p>
</section>
<section id="cvcrossmanova.optimizelambda" class="level3">
<h3 class="anchored" data-anchor-id="cvcrossmanova.optimizelambda"><span class="smallcaps">method</span> <code>optimizeLambda</code></h3>
<p>optimize regularization parameter for (a subset of) the dependent variables</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode matlab code-with-copy"><code class="sourceCode matlab"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>[<span class="va">ol</span><span class="op">,</span> <span class="va">MSE</span>] <span class="op">=</span> <span class="va">ccm</span>.<span class="va">optimizeLambda</span>(<span class="va">vi</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>[<span class="va">ol</span><span class="op">,</span> <span class="va">MSE</span>] <span class="op">=</span> <span class="va">ccm</span>.<span class="va">optimizeLambda</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>vi</code> specifies the variables to be included in the analysis, as column indices into the data matrices <code>Ys</code> of <code>modeledData</code>. If omitted, all variables are included.</p>
<p><code>ol</code> is the optimal shrinkage regularization parameter <code>lambda</code>, a number between 0 and 1.</p>
<p><code>MSE</code> is the mean squared error of whitening at <code>ol</code>.</p>
<p>The optimal value is determined via leave-one-session-out cross-validation. The error covariance matrix is estimated from ‘training’ and ‘validation’ sessions, and the latter is whitened using a regularized version of the former. The deviation from the optimal result, the identity matrix, is quantified by the squared error, averaged across matrix elements and cross-validation folds. The regularization parameter is chosen such that the mean squared error is minimal. Because the ‘training’ error covariance matrix used for whitening is calculated from less than the full number of samples, <code>ol</code> will likely overestimate the optimum for the actual analysis.</p>
</section>
<section id="cvcrossmanova.nresults" class="level3">
<h3 class="anchored" data-anchor-id="cvcrossmanova.nresults"><span class="smallcaps">method</span> <code>nResults</code></h3>
<p>return the number of values returned by <code>runAnalyses</code></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode matlab code-with-copy"><code class="sourceCode matlab"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="va">nr</span> <span class="op">=</span> <span class="va">ccm</span>.<span class="va">nResults</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>nr</code> is an array where each element corresponds to an analysis, and the value specifies the number of results returned for that analysis. For an analysis without permutations, that value is 1; otherwise it is the number of permutations.</p>
</section>
<section id="cvcrossmanova.checkestimability" class="level3">
<h3 class="anchored" data-anchor-id="cvcrossmanova.checkestimability"><span class="smallcaps">method</span> <code>checkEstimability</code></h3>
<p>check estimability of all contrasts of all analyses in all sessions</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode matlab code-with-copy"><code class="sourceCode matlab"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>[<span class="va">estimability</span><span class="op">,</span> <span class="va">problems</span>] <span class="op">=</span> <span class="va">ccm</span>.<span class="va">checkEstimability</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>estimability</code> is a table with one row per session and one column per analysis &amp; contrast. ‘true’ means that the contrast is estimable, ‘false’ that it is not estimable, ‘–’ that the contrast does not apply to the session.</p>
<p><code>problems</code> indicates whether there are any inestimable contrasts (logical).</p>
<p>It is not usually necessary to use this method explicitly, because estimability is checked upon creation of a <code>CvCrossManova</code> object.</p>
</section>
<section id="cvcrossmanova.disp" class="level3">
<h3 class="anchored" data-anchor-id="cvcrossmanova.disp"><span class="smallcaps">method</span> <code>disp</code></h3>
<p>textually display information about the object</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode matlab code-with-copy"><code class="sourceCode matlab"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="va">ccm</span>.<span class="va">disp</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This method overrides Matlab’s <code>disp</code>, so you can also use <code>disp(ccm)</code> or simply <code>ccm</code> without semicolon to get the same output.</p>
</section>
</section>
<section id="searchlightsize" class="level2">
<h2 class="anchored" data-anchor-id="searchlightsize"><span class="smallcaps">function</span> <code>searchlightSize</code></h2>
<p>searchlight size as a function of searchlight radius</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode matlab code-with-copy"><code class="sourceCode matlab"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="va">p</span> <span class="op">=</span> <span class="va">searchlightSize</span>(<span class="va">radius</span><span class="op">,</span> <span class="va">mat</span> <span class="op">=</span> <span class="va">eye</span>(<span class="fl">3</span>)<span class="op">,</span> <span class="va">file</span> <span class="op">=</span> <span class="st">""</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="va">tbl</span> <span class="op">=</span> <span class="va">searchlightSize</span>(<span class="va">mat</span> <span class="op">=</span> <span class="va">eye</span>(<span class="fl">3</span>)<span class="op">,</span> <span class="va">file</span> <span class="op">=</span> <span class="st">""</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="va">tbl</span> <span class="op">=</span> <span class="va">searchlightSize</span>([<span class="va">radiusMin</span><span class="op">,</span> <span class="va">radiusMax</span>]<span class="op">,</span> <span class="va">mat</span> <span class="op">=</span> <span class="va">eye</span>(<span class="fl">3</span>)<span class="op">,</span> <span class="va">file</span> <span class="op">=</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>With the first syntax, the number of voxels contained in a searchlight of radius <code>radius</code> is returned as <code>p</code>.</p>
<p>With the other syntaxes, a table of corresponding values of <code>radius</code> and <code>p</code> is returned as <code>tbl</code>. By default, the table includes <code>radius</code> values from 0 to 5, but another range can be specified as <code>[radiusMin, radiusMax]</code>. The tabulated values of <code>radius</code> are chosen such that all possible searchlight sizes in that range are listed.</p>
<p>Without further information, <code>radius</code> is in voxels. The optional <code>mat</code> can be used to specify a transformation matrix from voxel space to physical space, and then <code>radius</code> is in the same physical units as <code>mat</code>. Alternatively, the optional <code>file</code> can be used to specify the filename of an <code>SPM.mat</code> file or NIfTI file from which to read the transformation matrix, and then <code>radius</code> is in mm. If both are given, <code>file</code> overrides <code>mat</code>.</p>
<!-- Copyright © 2023 Carsten Allefeld
SPDX-License-Identifier: GPL-3.0-or-later -->



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list">
<div id="ref-allefeld2016" class="csl-entry" role="listitem">
Allefeld, C., Görgen, K., &amp; Haynes, J.-D. (2016). Valid population inference for information-based imaging: From the second-level <em>t</em>-test to prevalence inference. <em>NeuroImage</em>, <em>141</em>, 378–392. <a href="https://doi.org/10.1016/j.neuroimage.2016.07.040">https://doi.org/10.1016/j.neuroimage.2016.07.040</a>
</div>
<div id="ref-allefeld2014" class="csl-entry" role="listitem">
Allefeld, C., &amp; Haynes, J.-D. (2014). Searchlight-based multi-voxel pattern analysis of fMRI by cross-validated MANOVA. <em>NeuroImage</em>, <em>89</em>, 345–357. <a href="https://doi.org/10.1016/j.neuroimage.2013.11.043">https://doi.org/10.1016/j.neuroimage.2013.11.043</a>
</div>
<div id="ref-dwass1957" class="csl-entry" role="listitem">
Dwass, M. (1957). Modified randomization tests for nonparametric hypotheses. <em>Annals of Mathematical Statistics</em>, <em>28</em>(1), 181–187. <a href="https://doi.org/10.1214/aoms/1177707045">https://doi.org/10.1214/aoms/1177707045</a>
</div>
<div id="ref-ernst2004" class="csl-entry" role="listitem">
Ernst, M. D. (2004). Permutation methods: A basis for exact inference. <em>Statistical Science</em>, <em>19</em>(4), 676–685. <a href="https://doi.org/10.1214/088342304000000396">https://doi.org/10.1214/088342304000000396</a>
</div>
<div id="ref-schaefer2005" class="csl-entry" role="listitem">
Schäfer, J., &amp; Strimmer, K. (2005). A shrinkage approach to large-scale covariance matrix estimation and implications for functional genomics. <em>Statistical Applications in Genetics and Molecular Biology</em>, <em>4</em>(1). <a href="https://doi.org/10.2202/1544-6115.1175">https://doi.org/10.2202/1544-6115.1175</a>
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./tutorial-other/preparation.html" class="pagination-link" aria-label="Preparation">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Preparation</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->




</body></html>